# Design of an Efficient TTFS-SNN-Based EEG Emotion Recognition System on Lightweight FPGA
基于 TTFS-SNN 的高效 EEG 情绪识别系统轻量 FPGA 实现
## 摘要
**关键词：** Spiking Neural Network (SNN)；Depthwise Separable Convolution；Energy-Efficient；Lightweight
## 1. INTRODUCTION
### 1.1 研究背景
### 1.2 研究意义
### 1.3 主要贡献
## 2. RELATED WORK
### 2.1 脉冲神经网络研究现状
### 2.2 深度可分离卷积研究进展
### 2.3 神经网络硬件加速技术
## 3. METHODOLOGY AND ALGORITHM
### 3.1 整体架构
本研究提出了一种混合神经网络架构，将基于深度可分离卷积的特征提取模块与脉冲神经网络（SNN）有机融合，旨在基于轻量级FPGA实现高效处理脑电（EEG）信号的情绪识别任务。该架构的核心在于桥接了人工神经网络的特征提取能力与脉冲神经网络的生物启发式计算范式，通过TTFS（Time-To-First-Spike）无除法编码机制实现衔接，从而在大幅降低计算复杂度的同时保证了模型的高表达力与系统的能效和实时性。具体而言，输入EEG特征信号首先经深度可分离卷积模块进行多尺度特征抽象，该模块通过深度卷积捕捉通道内的局部时空特征，并借助逐点卷积融合跨通道信息，通过整合电极间的空间相关性和频域特征实现对EEG信号中通道间拓扑关系的深入挖。随后，这些提取的连续激活特征通过TTFS编码转换为时域脉冲序列，并输入SNN模块完成分类决策，其中SNN主要通过TTFS编码处理时序动态，专注于脉冲时序编码的信息传播，而非直接感知空间拓扑，从而与前置特征提取模块形成互补。
### 3.2 深度可分离卷积的硬件友好型设计
深度可分离卷积（Depthwise Separable Convolution）构成了本系统特征提取模块的核心，其设计旨在通过对标准卷积运算进行分解，以一种计算高效的方式，精细化地提取脑电（EEG）信号中蕴含的多维度时空特征。此架构不仅显著降低了模型的参数量与运算复杂度，更重要的是，其固有的结构特性为在资源受限的FPGA平台上实现高性能硬件加速提供了理论基础。
该模块的设计遵循两个核心步骤：深度卷积（Depthwise Convolution）与逐点卷积（Pointwise Convolution）。首先，深度卷积在输入的各个特征通道上独立地进行空间滤波，其目的在于捕捉每个通道内部的局部相关性与模式，例如特定电极附近信号的时域动态。随后，逐点卷积利用1x1的卷积核对深度卷积的输出进行线性组合，从而实现跨通道的信息融合与特征抽象。这种分解策略，将空间特征提取与通道特征整合解耦，相较于标准卷积在一次操作中同时处理二者，极大地减少了乘累加运算的需求。
该分解策略的硬件友好性体现在多个层面。首先，其运算量相较于标准卷积呈指数级降低。对于一个`KxK`的标准卷积，其计算成本约为$O(K^2 \cdot C_{in} \cdot C_{out})$，而深度可分离卷积的成本降至约$O(K^2 \cdot C_{in} + C_{in} \cdot C_{out})$，可节省数倍的乘累加（MAC）运算，从而显著减少对FPGA上宝贵的DSP（数字信号处理）或逻辑资源的需求。

其次，整个特征提取器由固定模式的模块串联而成，形成了规整、重复的结构化数据流，这非常适合在FPGA上构建深度流水线（Pipeline）。数据能够无阻塞地流经一系列处理单元，从而实现极高的处理吞-吐量。此外，通过采用大于1的步长（stride）进行卷积，可在提取特征的同时高效地对特征图进行降采样，显著减少后续层需要处理和缓存的数据量，进而节约片上缓存（BRAM）资源并降低功耗。

最后，该设计体现了算法与硬件的协同优化思想，特别是在算子替换方面。例如，在需要对数据进行归一化时，系统避免了在FPGA上实现昂贵且低效的通用浮点除法，而是通过将除数约束为2的整数次幂，使该操作在硬件层面可由一个高效、零开销的逻辑位移（Bit-Shift）操作替代。这一系列设计共同确保了模型在硬件上的高效运行。
为进一步增强模型的表达能力与训练稳定性，该模块在卷积层后集成了批标准化（Batch Normalization）与非线性激活函数（ReLU）。批标准化旨在缓解内部协变量偏移问题，加速网络收敛，而激活函数则为模型引入了必要的非线性表达能力。这一系列设计在后续可以通过参数融合优化的批标准化和利用ReLU的硬件原生性共同构成了一个高效、低功耗的特征提取前端，为脉冲神经网络（SNN）模块提供了高质量的输入特征，是整个系统实现高能效比的关键。
### 3.3 TTFS编码机制设计
TTFS编码机制作为特征提取模块与SNN间的关键桥梁，采用硬件优化的无除法实现方案，以二次幂缩放替代传统归一化操作，从而规避浮点运算的开销。该机制首先通过动量更新机制跟踪输入激活的动态范围，随后计算移位位数生成缩放因子，对激活值进行钳位处理，最终映射为脉冲时间序列。该过程确保了编码的实时性和低延迟特性，相比速率编码范式，更为契合SNN的时序动态。该设计的创新在于其对时间参数的灵活调整，支持层间传播优化，以适应不同网络深度的需求。通过该机制，系统实现了从连续激活到离散脉冲的平滑转换，为后续脉冲计算提供了生物学上合理的表示形式。
### 3.4 SNN模块设计
SNN模块基于多层全连接脉冲神经元构建，集成于统一的模型容器中，负责处理TTFS编码后的时序信号，实现情绪类别的最终判别。各脉冲层包括权重矩阵和偏差参数，前向传播逻辑区分隐藏层与输出层：隐藏层计算阈值并钳位输出，同时记录最小有效脉冲以动态调节时间窗；输出层则融合累积潜力和时序偏差，实现分类映射。该模块支持逐层添加组件，包括编码器和正则化层，权重采用均匀初始化以促进稳定训练。时间参数通过级联设置机制传播，结合动态扩展策略增强网络的表达能力。该设计强调SNN的低功耗潜力，通过时序编码捕捉EEG信号的微妙动态，为实时情绪识别提供了高效的计算范式。
## 4. HARDWARE ARCHITECTURE
### 4.1 FPGA整体架构
本系统的FPGA实现采用了GALS（Globally Asynchronous Locally Synchronous）双时钟域设计，模块内部集成时钟门控机制，以优化功耗和时序性能。整体架构由顶层模块、深度可分离卷积流处理模块、SNN处理模块以及跨域同步模块构成。通过全流水线处理路径，实现了数据从输入到输出的高效传输与计算。顶层模块协调各子系统，利用双翻转同步器处理起始信号、脉冲握手及完成标志的跨域通信，确保异步接口的可靠性。该架构的创新在于其对异构计算的适应性，深度可分离卷积域注重并行加速，SNN域强调时序脉冲处理，从而在有限资源下实现了系统级优化，为嵌入式EEG应用提供了可移植的硬件框架。
### 4.2 深度可分离卷积模块
深度可分离卷积模块采用流式处理架构，实现硬件级加速。输入特征通过块随机访问存储器（BRAM）接口加载，内部利用多路ROM同步模块，按通道拆分存储卷积核、权重、偏置及缩放参数，确保参数访问的低延迟。卷积流程分层展开：深度卷积捕捉通道内模式，点卷积实现跨通道融合，支持可配置步长以适应特征尺度变换。输出经TTFS编码单元转换为脉冲序列，使用移位缩放机制避免除法运算。有限状态机（FSM）控制像素级流水，包括空闲、计算及发送阶段，与下游模块的异步握手接口无缝对接。该模块的设计突出资源效率，通过常量优化和串行输出，提升了在FPGA上的部署适用性。
### 4.3 SNN 模块
SNN模块实现多层脉冲网络，采用FSM驱动的阶段性计算流程，包括累加、桥接及最终决策。各层利用ROM同步加载权重和参数，RAM同步维护中间状态，支持并行神经元访问。桥接单元将层间扁平化结果转换为串行脉冲流，支持无效脉冲过滤以减少传输冗余。输入接口接收上游脉冲信号，输出层集成ArgMax单元提取最大潜力类别。时钟门控逻辑仅在对应状态激活子模块，显著降低动态功耗。内存接口设计强调数据一致性，确保权重和状态的高效复用。该模块的架构优化聚焦于时序精确性和低延迟，体现了SNN在FPGA上的生物仿真优势，为EEG情绪识别的嵌入式实现提供了坚实基础。
## 5. IMPLEMENTATION AND RESULTS
### 5.1 数据集、预处理和实验环境
### 5.2 模型性能分析
软件：不同模型架构的性能对比：准确率、精确率、召回率、F1分数等指标
混淆矩阵：各类情绪分类的预测结果
鲁棒性分析：加入不同强度的高斯噪声，模拟实际工作环境
### 5.3 硬件性能分析
FPGA的实际准确率
吞吐量
FPGA资源占用
量化分析：从32、16位、8位、6位到4位
## 6. CONCLUSION
### 6.1 研究总结
### 6.2 未来工作展望
